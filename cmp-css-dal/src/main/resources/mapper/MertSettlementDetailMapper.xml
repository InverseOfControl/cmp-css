<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ipaylinks.cmp.css.dal.mapper.MertSettlementDetailMapper">
  <resultMap id="BaseResultMap" type="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="MERCHANT_ORDER_ID" jdbcType="VARCHAR" property="merchantOrderId" />
    <result column="ORDER_ID" jdbcType="VARCHAR" property="orderId" />
    <result column="CLEARING_DETAIL_ID" jdbcType="VARCHAR" property="clearingDetailId" />
    <result column="MERCHANT_ID" jdbcType="VARCHAR" property="merchantId" />
    <result column="MERCHANT_NAME" jdbcType="VARCHAR" property="merchantName" />
    <result column="TRANS_TYPE" jdbcType="VARCHAR" property="transType" />
    <result column="AMOUNT_TYPE" jdbcType="VARCHAR" property="amountType" />
    <result column="TRANS_CURRENCY" jdbcType="VARCHAR" property="transCurrency" />
    <result column="TRANS_AMOUNT" jdbcType="DECIMAL" property="transAmount" />
    <result column="SETTLE_TYPE" jdbcType="VARCHAR" property="settleType" />
    <result column="SETTLE_CURRENCY" jdbcType="VARCHAR" property="settleCurrency" />
    <result column="SETTLE_AMOUNT" jdbcType="DECIMAL" property="settleAmount" />
    <result column="SETTLE_RATE" jdbcType="DECIMAL" property="settleRate" />
    <result column="SETTLE_DATE" jdbcType="VARCHAR" property="settleDate" />
    <result column="SETTLEMENT_ID" jdbcType="VARCHAR" property="settlementId" />
    <result column="SETTLE_BATCH_ID" jdbcType="VARCHAR" property="settleBatchId" />
    <result column="FEE_SETTLE_METHOD" jdbcType="VARCHAR" property="feeSettleMethod" />
    <result column="SETTLE_STATUS" jdbcType="VARCHAR" property="settleStatus" />
    <result column="SETTLE_TIME" jdbcType="TIMESTAMP" property="settleTime" />
    <result column="GMT_CREATE_TIME" jdbcType="TIMESTAMP" property="gmtCreateTime" />
    <result column="GMT_UPDATE_TIME" jdbcType="TIMESTAMP" property="gmtUpdateTime" />
    <result column="PAY_METHOD" jdbcType="VARCHAR" property="payMethod" />
    <result column="ACCOUNTING_STATUS" jdbcType="VARCHAR" property="accountingStatus" />
    <result column="ACCOUNTING_ID" jdbcType="VARCHAR" property="accountingId" />
    <result column="ACCOUNTING_TIME" jdbcType="TIMESTAMP" property="accountingTime" />
    <result column="DEPOSIT_STATUS" jdbcType="TIMESTAMP" property="depositStatus" />
    <result column="ORDER_TYPE" jdbcType="VARCHAR" property="orderType" />
    <result column="ORI_ID" jdbcType="VARCHAR" property="oriId" />
    <result column="PAY_COMPLETE_TIME" jdbcType="TIMESTAMP" property="payCompleteTime" />
    <result column="PAY_KIND" jdbcType="VARCHAR" property="payKind" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    ID, MERCHANT_ORDER_ID, ORDER_ID, CLEARING_DETAIL_ID, MERCHANT_ID,
    MERCHANT_NAME, TRANS_TYPE, AMOUNT_TYPE, TRANS_CURRENCY, TRANS_AMOUNT, SETTLE_TYPE, 
    SETTLE_CURRENCY, SETTLE_AMOUNT, SETTLE_RATE, SETTLE_DATE, SETTLEMENT_ID, SETTLE_BATCH_ID, 
    FEE_SETTLE_METHOD, SETTLE_STATUS, SETTLE_TIME, GMT_CREATE_TIME, GMT_UPDATE_TIME, 
    PAY_METHOD, ACCOUNTING_STATUS, ACCOUNTING_ID, ACCOUNTING_TIME,DEPOSIT_STATUS, ORDER_TYPE, ORI_ID,PAY_COMPLETE_TIME, PAY_KIND
  </sql>
  
   <sql id="Base_Column_Task_List">
    MERCHANT_ID,SETTLE_DATE
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    delete from T_MERT_SETTLEMENT_DETAIL
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
    <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE">
      SELECT TO_CHAR(SYSDATE, 'yymmddhh24miss')||SEQ_CYCLE_FOR_ID.nextval FROM DUAL
    </selectKey>
    insert into T_MERT_SETTLEMENT_DETAIL (ID, MERCHANT_ORDER_ID,
      ORDER_ID, CLEARING_DETAIL_ID, MERCHANT_ID, 
      MERCHANT_NAME, TRANS_TYPE, AMOUNT_TYPE, 
      TRANS_CURRENCY, TRANS_AMOUNT, SETTLE_TYPE, 
      SETTLE_CURRENCY, SETTLE_AMOUNT, SETTLE_RATE, 
      SETTLE_DATE, SETTLEMENT_ID, SETTLE_BATCH_ID, 
      FEE_SETTLE_METHOD, SETTLE_STATUS, SETTLE_TIME, 
      GMT_CREATE_TIME, GMT_UPDATE_TIME, PAY_METHOD, 
      ACCOUNTING_STATUS, ACCOUNTING_ID, ACCOUNTING_TIME,DEPOSIT_STATUS, ORDER_TYPE, ORI_ID,PAY_COMPLETE_TIME, PAY_KIND
      )
    values (#{id,jdbcType=VARCHAR}, #{merchantOrderId,jdbcType=VARCHAR},
      #{orderId,jdbcType=VARCHAR}, #{clearingDetailId,jdbcType=VARCHAR}, #{merchantId,jdbcType=VARCHAR}, 
      #{merchantName,jdbcType=VARCHAR}, #{transType,jdbcType=VARCHAR}, #{amountType,jdbcType=VARCHAR}, 
      #{transCurrency,jdbcType=VARCHAR}, #{transAmount,jdbcType=DECIMAL}, #{settleType,jdbcType=VARCHAR}, 
      #{settleCurrency,jdbcType=VARCHAR}, #{settleAmount,jdbcType=DECIMAL}, #{settleRate,jdbcType=DECIMAL}, 
      #{settleDate,jdbcType=VARCHAR}, #{settlementId,jdbcType=VARCHAR}, #{settleBatchId,jdbcType=VARCHAR}, 
      #{feeSettleMethod,jdbcType=VARCHAR}, #{settleStatus,jdbcType=VARCHAR}, #{settleTime,jdbcType=TIMESTAMP}, 
      #{gmtCreateTime,jdbcType=TIMESTAMP}, #{gmtUpdateTime,jdbcType=TIMESTAMP}, #{payMethod,jdbcType=VARCHAR}, 
      #{accountingStatus,jdbcType=VARCHAR}, #{accountingId,jdbcType=VARCHAR}, #{accountingTime,jdbcType=TIMESTAMP},
      #{depositStatus,jdbcType=VARCHAR}, #{orderType,jdbcType=VARCHAR}, #{oriId,jdbcType=VARCHAR}, #{payCompleteTime,jdbcType=TIMESTAMP}, #{payKind,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
    <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE">
      SELECT TO_CHAR(SYSDATE, 'yymmddhh24miss')||SEQ_CYCLE_FOR_ID.nextval FROM DUAL
    </selectKey>
    insert into T_MERT_SETTLEMENT_DETAIL
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="merchantOrderId != null">
        MERCHANT_ORDER_ID,
      </if>
      <if test="orderId != null">
        ORDER_ID,
      </if>
      <if test="clearingDetailId != null">
        CLEARING_DETAIL_ID,
      </if>
      <if test="merchantId != null">
        MERCHANT_ID,
      </if>
      <if test="merchantName != null">
        MERCHANT_NAME,
      </if>
      <if test="transType != null">
        TRANS_TYPE,
      </if>
      <if test="amountType != null">
        AMOUNT_TYPE,
      </if>
      <if test="transCurrency != null">
        TRANS_CURRENCY,
      </if>
      <if test="transAmount != null">
        TRANS_AMOUNT,
      </if>
      <if test="settleType != null">
        SETTLE_TYPE,
      </if>
      <if test="settleCurrency != null">
        SETTLE_CURRENCY,
      </if>
      <if test="settleAmount != null">
        SETTLE_AMOUNT,
      </if>
      <if test="settleRate != null">
        SETTLE_RATE,
      </if>
      <if test="settleDate != null">
        SETTLE_DATE,
      </if>
      <if test="settlementId != null">
        SETTLEMENT_ID,
      </if>
      <if test="settleBatchId != null">
        SETTLE_BATCH_ID,
      </if>
      <if test="feeSettleMethod != null">
        FEE_SETTLE_METHOD,
      </if>
      <if test="settleStatus != null">
        SETTLE_STATUS,
      </if>
      <if test="settleTime != null">
        SETTLE_TIME,
      </if>
      <if test="gmtCreateTime != null">
        GMT_CREATE_TIME,
      </if>
      <if test="gmtUpdateTime != null">
        GMT_UPDATE_TIME,
      </if>
      <if test="payMethod != null">
        PAY_METHOD,
      </if>
      <if test="accountingStatus != null">
        ACCOUNTING_STATUS,
      </if>
      <if test="accountingId != null">
        ACCOUNTING_ID,
      </if>
      <if test="accountingTime != null">
        ACCOUNTING_TIME,
      </if>
      <if test="depositStatus != null">
        DEPOSIT_STATUS,
      </if>
      <if test="orderType != null">
        ORDER_TYPE,
      </if>
      <if test="oriId != null">
        ORI_ID,
      </if>
       <if test="payCompleteTime != null">
        PAY_COMPLETE_TIME,
      </if>
      <if test="payKind != null">
        PAY_KIND,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="merchantOrderId != null">
        #{merchantOrderId,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null">
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="clearingDetailId != null">
        #{clearingDetailId,jdbcType=VARCHAR},
      </if>
      <if test="merchantId != null">
        #{merchantId,jdbcType=VARCHAR},
      </if>
      <if test="merchantName != null">
        #{merchantName,jdbcType=VARCHAR},
      </if>
      <if test="transType != null">
        #{transType,jdbcType=VARCHAR},
      </if>
      <if test="amountType != null">
        #{amountType,jdbcType=VARCHAR},
      </if>
      <if test="transCurrency != null">
        #{transCurrency,jdbcType=VARCHAR},
      </if>
      <if test="transAmount != null">
        #{transAmount,jdbcType=DECIMAL},
      </if>
      <if test="settleType != null">
        #{settleType,jdbcType=VARCHAR},
      </if>
      <if test="settleCurrency != null">
        #{settleCurrency,jdbcType=VARCHAR},
      </if>
      <if test="settleAmount != null">
        #{settleAmount,jdbcType=DECIMAL},
      </if>
      <if test="settleRate != null">
        #{settleRate,jdbcType=DECIMAL},
      </if>
      <if test="settleDate != null">
        #{settleDate,jdbcType=VARCHAR},
      </if>
      <if test="settlementId != null">
        #{settlementId,jdbcType=VARCHAR},
      </if>
      <if test="settleBatchId != null">
        #{settleBatchId,jdbcType=VARCHAR},
      </if>
      <if test="feeSettleMethod != null">
        #{feeSettleMethod,jdbcType=VARCHAR},
      </if>
      <if test="settleStatus != null">
        #{settleStatus,jdbcType=VARCHAR},
      </if>
      <if test="settleTime != null">
        #{settleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtCreateTime != null">
        #{gmtCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtUpdateTime != null">
        #{gmtUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payMethod != null">
        #{payMethod,jdbcType=VARCHAR},
      </if>
      <if test="accountingStatus != null">
        #{accountingStatus,jdbcType=VARCHAR},
      </if>
      <if test="accountingId != null">
        #{accountingId,jdbcType=VARCHAR},
      </if>
      <if test="accountingTime != null">
        #{accountingTime,jdbcType=TIMESTAMP},
      </if>
       <if test="depositStatus != null">
        #{depositStatus,jdbcType=VARCHAR},
      </if>
      <if test="orderType != null">
        #{orderType,jdbcType=VARCHAR},
      </if>
      <if test="oriId != null">
        #{oriId,jdbcType=VARCHAR},
      </if>
      <if test="payCompleteTime != null">
        #{payCompleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payKind != null">
        #{payKind,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    update T_MERT_SETTLEMENT_DETAIL
    <set>
      <if test="merchantOrderId != null">
        MERCHANT_ORDER_ID = #{merchantOrderId,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null">
        ORDER_ID = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="clearingDetailId != null">
        CLEARING_DETAIL_ID = #{clearingDetailId,jdbcType=VARCHAR},
      </if>
      <if test="merchantId != null">
        MERCHANT_ID = #{merchantId,jdbcType=VARCHAR},
      </if>
      <if test="merchantName != null">
        MERCHANT_NAME = #{merchantName,jdbcType=VARCHAR},
      </if>
      <if test="transType != null">
        TRANS_TYPE = #{transType,jdbcType=VARCHAR},
      </if>
      <if test="amountType != null">
        AMOUNT_TYPE = #{amountType,jdbcType=VARCHAR},
      </if>
      <if test="transCurrency != null">
        TRANS_CURRENCY = #{transCurrency,jdbcType=VARCHAR},
      </if>
      <if test="transAmount != null">
        TRANS_AMOUNT = #{transAmount,jdbcType=DECIMAL},
      </if>
      <if test="settleType != null">
        SETTLE_TYPE = #{settleType,jdbcType=VARCHAR},
      </if>
      <if test="settleCurrency != null">
        SETTLE_CURRENCY = #{settleCurrency,jdbcType=VARCHAR},
      </if>
      <if test="settleAmount != null">
        SETTLE_AMOUNT = #{settleAmount,jdbcType=DECIMAL},
      </if>
      <if test="settleRate != null">
        SETTLE_RATE = #{settleRate,jdbcType=DECIMAL},
      </if>
      <if test="settleDate != null">
        SETTLE_DATE = #{settleDate,jdbcType=VARCHAR},
      </if>
      <if test="settlementId != null">
        SETTLEMENT_ID = #{settlementId,jdbcType=VARCHAR},
      </if>
      <if test="settleBatchId != null">
        SETTLE_BATCH_ID = #{settleBatchId,jdbcType=VARCHAR},
      </if>
      <if test="feeSettleMethod != null">
        FEE_SETTLE_METHOD = #{feeSettleMethod,jdbcType=VARCHAR},
      </if>
      <if test="settleStatus != null">
        SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR},
      </if>
      <if test="settleTime != null">
        SETTLE_TIME = #{settleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtCreateTime != null">
        GMT_CREATE_TIME = #{gmtCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtUpdateTime != null">
        GMT_UPDATE_TIME = #{gmtUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payMethod != null">
        PAY_METHOD = #{payMethod,jdbcType=VARCHAR},
      </if>
      <if test="accountingStatus != null">
        ACCOUNTING_STATUS = #{accountingStatus,jdbcType=VARCHAR},
      </if>
      <if test="accountingId != null">
        ACCOUNTING_ID = #{accountingId,jdbcType=VARCHAR},
      </if>
      <if test="accountingTime != null">
        ACCOUNTING_TIME = #{accountingTime,jdbcType=TIMESTAMP},
      </if>
      <if test="depositStatus != null">
        DEPOSIT_STATUS = #{depositStatus,jdbcType=TIMESTAMP},
      </if>
       <if test="payCompleteTime != null">
        PAY_COMPLETE_TIME = #{payCompleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payKind != null">
        PAY_KIND = #{payKind,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
    <!--
      @MBG Generated
      This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Wed Aug 01 11:17:20 CST 2018.
    -->
    update T_MERT_SETTLEMENT_DETAIL
    set
      MERCHANT_ORDER_ID = #{merchantOrderId,jdbcType=VARCHAR},
      ORDER_ID = #{orderId,jdbcType=VARCHAR},
      CLEARING_DETAIL_ID = #{clearingDetailId,jdbcType=VARCHAR},
      MERCHANT_ID = #{merchantId,jdbcType=VARCHAR},
      MERCHANT_NAME = #{merchantName,jdbcType=VARCHAR},
      TRANS_TYPE = #{transType,jdbcType=VARCHAR},
      AMOUNT_TYPE = #{amountType,jdbcType=VARCHAR},
      TRANS_CURRENCY = #{transCurrency,jdbcType=VARCHAR},
      TRANS_AMOUNT = #{transAmount,jdbcType=DECIMAL},
      SETTLE_TYPE = #{settleType,jdbcType=VARCHAR},
      SETTLE_CURRENCY = #{settleCurrency,jdbcType=VARCHAR},
      SETTLE_AMOUNT = #{settleAmount,jdbcType=DECIMAL},
      SETTLE_RATE = #{settleRate,jdbcType=DECIMAL},
      SETTLE_DATE = #{settleDate,jdbcType=VARCHAR},
      SETTLEMENT_ID = #{settlementId,jdbcType=VARCHAR},
      SETTLE_BATCH_ID = #{settleBatchId,jdbcType=VARCHAR},
      FEE_SETTLE_METHOD = #{feeSettleMethod,jdbcType=VARCHAR},
      SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR},
      SETTLE_TIME = #{settleTime,jdbcType=TIMESTAMP},
      GMT_CREATE_TIME = #{gmtCreateTime,jdbcType=TIMESTAMP},
      GMT_UPDATE_TIME = #{gmtUpdateTime,jdbcType=TIMESTAMP},
      PAY_METHOD = #{payMethod,jdbcType=VARCHAR},
      ACCOUNTING_STATUS = #{accountingStatus,jdbcType=VARCHAR},
      ACCOUNTING_ID = #{accountingId,jdbcType=VARCHAR},
      ACCOUNTING_TIME = #{accountingTime,jdbcType=TIMESTAMP},
      DEPOSIT_STATUS = #{depositStatus,jdbcType=VARCHAR},
      PAY_COMPLETE_TIME = #{payCompleteTime,jdbcType=TIMESTAMP},
      PAY_KIND = #{payKind,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>

  <select id="getMertSettlementDetail" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要待结算明细
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where  SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR}
  </select>
    
    <select id="createSettleDetailToSettleTask" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要待结算明细
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where  SETTLE_TYPE = #{settleType,jdbcType=VARCHAR}
  </select>
  
    <select id="getMertSettlementAccountError" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要待结算明细
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where  SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR}
  </select>
  
  <select id="getMertSettlementAccountErrorDetail" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取记账失败的结算明细列表
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where   ACCOUNTING_STATUS = #{accountingStatus,jdbcType=VARCHAR} AND SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR} 
    <![CDATA[ AND SETTLE_DATE < CONCAT(#{settleDate,jdbcType=VARCHAR},'yyyy-MM-dd')]]> AND AMOUNT_TYPE NOT IN  ('06', '07')
  </select>

  <!-- 查询结算明细列表信息 -->
  <select id="selectList" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/> from T_MERT_SETTLEMENT_DETAIL
    where 1 = 1 <include refid="queryConditionSql"/>
    order by gmt_create_time desc
  </select>

  <sql id="queryConditionSql">
    <if test="merchantId != null and merchantId != ''">
      and merchant_id = #{merchantId}
    </if>
    <if test="merchantOrderId != null and merchantOrderId != ''">
      and merchant_order_id = #{merchantOrderId}
    </if>
    <if test="orderId != null and orderId != ''">
      and order_id = #{orderId}
    </if>
    <if test="transType != null and transType != ''">
      and trans_type = #{transType}
    </if>
    <if test="amountType != null and amountType != ''">
      and amount_type = #{amountType}
    </if>
    <if test="transCurrency != null and transCurrency != ''">
      and trans_currency = #{transCurrency}
    </if>
    <if test="feeSettleMethod != null and feeSettleMethod != ''">
      and fee_settle_method = #{feeSettleMethod}
    </if>
    <if test="settleCurrency != null and settleCurrency != ''">
      and settle_currency = #{settleCurrency}
    </if>
    <if test="settlementId != null and settlementId != ''">
      and settlement_id = #{settlementId}
    </if>
    <if test="settleStatus != null and settleStatus != ''">
      and settle_status = #{settleStatus}
    </if>
    <if test="accountingStatus != null and accountingStatus != ''">
      and accounting_status = #{accountingStatus}
    </if>
    and settle_date &gt;= #{beginSettleDate} and settle_date &lt;= #{endSettleDate}
  </sql>
  
  <select id="getSumMertSettlementDetail" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
   <!--统计分析生成结算单任务  -->
    	select
   		<include refid="Base_Column_List" />
   		 	from T_MERT_SETTLEMENT_DETAIL
    		where   SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR}
  </select>
  
  <!--根据商户编号和结算时间获取结算单明细汇总  -->
  <select id="getMertSettlementDetailByMerchantId" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
	   select sum(t.settle_amount) settle_amount,
          t.merchant_name,
          t.settle_currency,
          t.merchant_id,
          t.settle_type,
          t.settle_date,
          t.trans_type,
          t.amount_type,
          t.trans_currency,
          sum(t.trans_amount) trans_amount
     from T_MERT_SETTLEMENT_DETAIL t
     where t.merchant_id =#{merchantId}
       and t.settle_date <![CDATA[<=]]> #{settleDate}
       and t.settle_batch_id =#{settleBatchId}
       and t.deposit_status=#{depositStatus}
       and t.accounting_status=#{accountingStatus}
    group by t.settle_currency,
             t.merchant_id,
             t.settle_date,
             t.merchant_name,
             t.settle_type,
             t.trans_type,
             t.amount_type,
             t.trans_currency
            
  </select>
  <select id="getMertSettlementDetailDeposit" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要待生成保证金或者生成保证金失败的记录明细
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where  SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR} AND DEPOSIT_STATUS=#{depositStatus,jdbcType=VARCHAR} AND TRANS_TYPE in ('01', '02')
    <![CDATA[ AND SETTLE_DATE <= CONCAT(#{settleDate,jdbcType=VARCHAR},'yyyy-MM-dd')]]>
  </select>
  
   <resultMap id="BaseTaskResultMap" extends="BaseResultMap" type="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
	  <result column="SETTLE_START_TIME" jdbcType="VARCHAR" property="settleStartTime" />
	  <result column="SETTLE_COMPLETE_TIME" jdbcType="VARCHAR" property="settleCompleteTime" />
   </resultMap>
  <select id="getSumMertSettlementDetailTask" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseTaskResultMap">
    	select MERCHANT_ID, min(SETTLE_DATE) SETTLE_START_TIME , max(SETTLE_DATE) SETTLE_COMPLETE_TIME
		from t_mert_settlement_detail
		where SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR}
			<![CDATA[ AND SETTLE_DATE <= CONCAT(#{settleDate,jdbcType=VARCHAR},'yyyy-MM-dd')]]>
		group by MERCHANT_ID
  </select>
  
  <!--回写结算单任务  -->
  <update id="updateMertSettlementDetail1" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
  	 update T_MERT_SETTLEMENT_DETAIL t set  t.SETTLE_BATCH_ID =#{settleBatchId} where t.MERCHANT_ID =#{merchantId} 
  	  AND t.SETTLE_STATUS='00' 
  	  AND t.SETTLE_DATE  <![CDATA[ >= ]]>#{settleStartTime,jdbcType=VARCHAR}
  	  AND t.SETTLE_DATE  <![CDATA[ <= ]]>#{settleCompleteTime,jdbcType=VARCHAR}
  </update>
  
    <select id="getMertSettlementDetailList" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要预处理待结算明细
    -->
    select 
    <include refid="Base_Column_List" />
    from T_MERT_SETTLEMENT_DETAIL
    where  SETTLE_STATUS = #{settleStatus,jdbcType=VARCHAR}
      AND  MERCHANT_ID = #{merchantId,jdbcType=VARCHAR}
      AND SETTLE_DATE <![CDATA[ >= ]]> #{settleStartTime,jdbcType=VARCHAR}
  	  AND SETTLE_DATE <![CDATA[ <= ]]>  #{settleCompleteTime,jdbcType=VARCHAR}
  </select>
  
   <select id="getMertSettlementDetailListByMerchantIdReport" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要预处理待结算明细
    -->
      select *
        from t_mert_settlement_detail t
       where t.merchant_id = #{merchantId,jdbcType=VARCHAR}
         and t.settlement_id = #{settlementId}
         and t.deposit_status = '01'
         and t.accounting_status = '1'
  </select>
  
  
    <!--回写结算单编号到结算明细  -->
  <update id="updateMertSettlementDetail1Id" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail">
  	update t_mert_settlement_detail t 
  	  set  t.settlement_id =#{settlementId} ,t.settle_status = #{settleStatus}, t.gmt_update_time = #{gmtUpdateTime}
  	 where t.merchant_id =#{merchantId}
       and t.settle_date <![CDATA[<=]]> #{settleDate}
       and t.settle_batch_id =#{settleBatchId}
       and t.deposit_status=#{depositStatus}
       and t.accounting_status=#{accountingStatus}
       and t.amount_type = #{amountType}
       and t.trans_type = #{transType}
       and t.trans_currency = #{transCurrency}
  </update>
     <select id="getDealMertSettlementOrderAbortDetail" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 获取需要预处理待结算明细
    -->
      select *
        from t_mert_settlement_detail t
       where t.merchant_id = #{merchantId,jdbcType=VARCHAR}
         and t.settlement_id = #{settlementId}
  </select>

  <select id="countTradeMerchant" parameterType="com.ipaylinks.cmp.css.dal.model.MertSettlementDetail" resultMap="BaseResultMap">
    <!--
      @MBG 统计所有需要出的对账单的交易商户
    -->
      select distinct t.merchant_id
	      from t_mert_settlement_detail t
	     where 1 = 1
	  order by t.merchant_id desc
  </select>
  
  <select id="getMertSettlementDetailListByOrderId" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      @MBG 根据清算主订单ID获取结算明细进行
    -->
     select 
        <include refid="Base_Column_List" />
	  from t_mert_settlement_detail t
	 where t.order_id = #{orderId}
  </select>
</mapper>
